---
/**
 * Header Component
 *
 * Main site header with navigation, logo, and theme toggle.
 * Features sticky behavior on scroll with backdrop blur effect.
 * Mobile-responsive with hamburger menu.
 *
 * @component
 */

import ThemeToggle from '@components/ui/ThemeToggle.astro';
import Navigation from './Navigation.astro';

interface Props {
  currentPath?: string;
}

const { currentPath = '' } = Astro.props;

// Detect current language from URL path
const currentLang = currentPath.startsWith('/en/') || currentPath === '/en' ? 'en' : 
                   currentPath.startsWith('/ro/') || currentPath === '/ro' ? 'ro' : 'de';

// Generate the base path for the current language
const basePath = currentLang === 'de' ? '' : `/${currentLang}`;
---

<header
  id="site-header"
  class="sticky top-0 z-50 w-full border-b transition-all duration-300"
  class:list={[
    'bg-light-bg/80 border-light-border backdrop-blur-md',
    'dark:bg-dark-bg/80 dark:border-dark-border',
  ]}
>
  <div class="container-custom">
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo/Brand -->
      <a
        href={basePath || '/'}
        class="flex items-center space-x-2 group focus-ring rounded-lg"
        aria-label="Go to homepage"
      >
        <span class="text-xl md:text-2xl font-bold text-gradient">
          MAM
        </span>
        <span class="hidden md:block text-lg font-medium text-text-primary-light dark:text-text-primary-dark">
          Mihai Adrian Mateescu
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <Navigation currentPath={currentPath} basePath={basePath} />
      </div>

      <!-- Right Section: Theme Toggle & Mobile Menu -->
      <div class="flex items-center space-x-4">
        <!-- Theme Toggle -->
        <ThemeToggle />

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-toggle"
          type="button"
          class="md:hidden p-2 rounded-lg focus-ring text-text-primary-light dark:text-text-primary-dark"
          aria-label="Toggle mobile menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg
            id="menu-icon"
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
          <svg
            id="close-icon"
            class="w-6 h-6 hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="md:hidden hidden"
      role="navigation"
      aria-label="Mobile navigation"
    >
      <div class="pb-4 pt-2 space-y-1 border-t border-light-border dark:border-dark-border">
        <Navigation currentPath={currentPath} basePath={basePath} mobile />
      </div>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  if (mobileMenuToggle && mobileMenu && menuIcon && closeIcon) {
    mobileMenuToggle.addEventListener('click', () => {
      const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';

      // Toggle menu visibility
      mobileMenu.classList.toggle('hidden');

      // Toggle icons
      menuIcon.classList.toggle('hidden');
      closeIcon.classList.toggle('hidden');

      // Update ARIA attribute
      mobileMenuToggle.setAttribute('aria-expanded', String(!isExpanded));

      // Prevent body scroll when menu is open
      document.body.style.overflow = isExpanded ? '' : 'hidden';
    });

    // Close menu when clicking outside
    document.addEventListener('click', (event) => {
      const target = event.target as HTMLElement;
      if (!mobileMenuToggle.contains(target) && !mobileMenu.contains(target)) {
        mobileMenu.classList.add('hidden');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
        mobileMenu.classList.add('hidden');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        mobileMenuToggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        mobileMenuToggle.focus();
      }
    });
  }

  // Add scroll behavior to header
  let lastScrollY = window.scrollY;
  const header = document.getElementById('site-header');

  window.addEventListener('scroll', () => {
    if (!header) return;

    const currentScrollY = window.scrollY;

    // Add shadow on scroll
    if (currentScrollY > 10) {
      header.classList.add('shadow-subtle');
    } else {
      header.classList.remove('shadow-subtle');
    }

    lastScrollY = currentScrollY;
  });
</script>

<style>
  /* Smooth transitions for mobile menu */
  #mobile-menu {
    animation: slideDown 0.2s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
