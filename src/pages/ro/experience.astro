---
/**
 * Experience Page
 *
 * Professional career timeline with 13 positions (2003-present)
 * Uses Timeline component to display chronological work history
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import Timeline from '@components/sections/Timeline.astro';
import Container from '@components/ui/Container.astro';
import Card from '@components/ui/Card.astro';
import Badge from '@components/ui/Badge.astro';
import { careerPositions } from '@data/experience';
import { translations } from '@data/translations';
import { generatePersonSchema, generateBreadcrumbSchema, generateWorkExperienceSchema } from '@utils/structuredData';

const lang = 'ro';
const t = translations[lang];

const title = `${t.experience.title} | Mihai Adrian Mateescu`;
const description = `${t.experience.subtitle} - t.home.quickLinks.experience`;

// Generate structured data
const personSchema = generatePersonSchema(lang);
const breadcrumbSchema = generateBreadcrumbSchema([
  { name: t.nav.home, url: '/ro/' },
  { name: t.experience.title, url: '/ro/experience' }
]);

// Generate WorkExperience schema for each position
const experienceSchemas = careerPositions.map(position => 
  generateWorkExperienceSchema(position)
);

const structuredData = [personSchema, breadcrumbSchema, ...experienceSchemas];

// Convert career positions to timeline items with proper formatting
const timelineItems = careerPositions.map((position) => {
  const dateStr = position.endDate === 'present'
    ? `${position.startDate.split('-')[1]}/${position.startDate.split('-')[0]} - ${t.experience.present}`
    : `${position.startDate.split('-')[1]}/${position.startDate.split('-')[0]} - ${position.endDate.split('-')[1]}/${position.endDate.split('-')[0]}`;

  return {
    id: position.id,
    company: position.company,
    role: position.role[lang],
    location: position.location,
    startDate: position.startDate.split('-')[1] + '/' + position.startDate.split('-')[0],
    endDate: position.endDate === 'present' ? t.experience.present : position.endDate.split('-')[1] + '/' + position.endDate.split('-')[0],
    description: position.description[lang].join('\n'),
    achievements: position.description[lang],
    technologies: position.technologies || [],
    icon: position.logo,
    current: position.endDate === 'present'
  };
});

// Skills gained from experience
const practicalSkills = t.experience.practicalSkills;
---

<BaseLayout title={title} description={description} lang={lang} structuredData={structuredData}>
  <Container>
    <!-- Page Header -->
    <section class="py-12 md:py-16">
      <div class="text-center max-w-3xl mx-auto">
        <h1 class="text-4xl md:text-5xl font-bold text-text-primary-light dark:text-text-primary-dark mb-4">
          {t.experience.title}
        </h1>
        <p class="text-xl text-text-secondary-light dark:text-text-secondary-dark">
          {t.experience.subtitle}
        </p>
        <div class="mt-6">
          <Badge variant="primary" size="lg">
            {careerPositions.length} {t.experience.positions}
          </Badge>
        </div>
      </div>
    </section>

    <!-- Career Timeline -->
    <section class="py-12">
      <Timeline items={timelineItems} />
    </section>

    <!-- Practical Skills Section -->
    <section class="py-12">
      <Card>
        <h2 class="text-2xl md:text-3xl font-bold text-text-primary-light dark:text-text-primary-dark mb-6">
          {t.experience.skillsTitle}
        </h2>
        <div class="flex flex-wrap gap-3">
          {practicalSkills.map((skill) => (
            <Badge variant="secondary">{skill}</Badge>
          ))}
        </div>
      </Card>
    </section>

    <!-- Back to Home Link -->
    <div class="py-8 text-center">
      <a
        href="/"
        class="text-eucalyptus-800 dark:text-eucalyptus-200 underline decoration-eucalyptus-600/50 dark:decoration-eucalyptus-400/50 hover:decoration-eucalyptus-700 dark:hover:decoration-eucalyptus-300 inline-flex items-center gap-2"
      >
        <span>‚Üê</span>
        <span>{t.common.backToHome}</span>
      </a>
    </div>
  </Container>
</BaseLayout>
